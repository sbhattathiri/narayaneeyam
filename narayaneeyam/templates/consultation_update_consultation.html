{% extends 'base.html' %}

{% block title %}Consultations{% endblock %}

{% block content %}
<h2 class="text-2xl font-bold mb-5">Add Consultation</h2>

<div class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-lg">
    <form id="consultationForm" method="post">
        {% csrf_token %}

        <!-- Patient and Doctor Selection -->
        <div class="mb-4">
            <label  class="block text-sm font-medium text-gray-700">Patient</label>
            {{ form.patient }}
        </div>
        <div class="mb-4">
            <label  class="block text-sm font-medium text-gray-700">Doctor</label>
            {{ form.doctor }}
        </div>

        <!-- Patients Concerns Field -->
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700">Patient's Concerns</label>
            {{ form.patient_concerns }}
        </div>

        <!-- Diagnosis Field -->
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700">Diagnosis</label>
            {{ form.diagnosis }}
        </div>

        <!-- Prescription Table -->
        <div class="mb-6">
            <label class="block text-sm font-medium text-gray-700 mb-2">Prescription</label>
            <table class="table-auto w-full border border-gray-300">
                <thead>
                <tr class="bg-gray-200">
                    <th class="border px-4 py-2">Medicine Name</th>
                    <th class="border px-4 py-2">Dosage</th>
                    <th class="border px-4 py-2 text-center">Actions</th>
                </tr>
                </thead>
                <tbody id="prescriptionTableBody">
                {% for item in form.initial.prescription %}
                <tr>
                    <td class="border px-4 py-2">
                        <input type="text" name="medicine_name[]" value="{{ item.name_of_medicine }}"
                               class="w-full border-gray-300 rounded px-2 py-1"/>
                    </td>
                    <td class="border px-4 py-2">
                        <input type="text" name="dosage[]" value="{{ item.dosage }}"
                               class="w-full border-gray-300 rounded px-2 py-1"/>
                    </td>
                    <td class="border px-4 py-2 text-center">
                        <button type="button"
                                class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 remove-row">Remove
                        </button>
                    </td>
                </tr>
                {% endfor %}
                </tbody>
            </table>
            <button type="button" id="addRow" class="mt-4 bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                Add Row
            </button>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="bg-blue-500 text-white px-4 py-2 mt-6 rounded hover:bg-blue-600">Save Changes
        </button>
    </form>
</div>

<script>
    // Add Row Logic
    document.getElementById('addRow').addEventListener('click', function () {
        const tableBody = document.getElementById('prescriptionTableBody');
        const newRow = `
            <tr>
                <td class="border px-4 py-2">
                    <input type="text" name="medicine_name[]" class="w-full border-gray-300 rounded px-2 py-1" />
                </td>
                <td class="border px-4 py-2">
                    <input type="text" name="dosage[]" class="w-full border-gray-300 rounded px-2 py-1" />
                </td>
                <td class="border px-4 py-2 text-center">
                    <button type="button" class="bg-red-500 text-white px-3 py-1 rounded hover:bg-red-600 remove-row">Remove</button>
                </td>
            </tr>`;
        tableBody.insertAdjacentHTML('beforeend', newRow);
    });

    // Remove Row Logic
    document.addEventListener('click', function (e) {
        if (e.target && e.target.classList.contains('remove-row')) {
            e.target.closest('tr').remove();
        }
    });
</script>
{% endblock %}
